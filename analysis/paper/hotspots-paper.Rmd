---
title: "Expression QTL hotspot dissection with mediation analysis and pleiotropy testing"
author: "Frederick J. Boehm, Brian S. Yandell, and Karl W. Broman"
date: "7/27/2019"
bibliography: research.bib
numberSections: true
linkReferences: true
link-citations: true
output: 
  bookdown::html_document2:
    pandoc_args: 
      - --filter
      - pandoc-crossref
---

```{r child="intro.Rmd"}
```


```{r load-broman}
library(broman)
library(here)
```


```{r child="methods.Rmd"}
```






# Results

We generated scatter plots of pleiotropy test statistics vs. mediation LOD difference values for each of the five hotspots (Figures).
Each point represents a pairing of a local trait with a nonlocal trait.
The mediation LOD difference value is that observed when the local trait is considered
as a candidate mediator of the QTL-nonlocal trait association.

In all five scatter plots, we observe few
points in the upper right quadrant of the figure.
That is, few pairs have high pleiotropy test statistics and
high mediation LOD difference values.

```{r setup}
library(qtl2hotspots)
pleio_threshold <- 4
ult <- 15 # univariate lod threshold
```

```{r load_tidyverse}
library(tidyverse)
options(tibble.print_max = 50, tibble.print_min = 20)
```


```{r load_heatmaply}
library(heatmaply)
```

```{r}
if (!file.exists(here("analysis", "data", "derived_data", "expr.rds"))){
  download.file("https://datadryad.org/bitstream/handle/10255/dryad.166774/Attie_DO378_eQTL_viewer_v1.Rdata?sequence=2",
              destfile = here("analysis", "data", "raw_data", "Attie_DO378_eQTL_viewer_v1.Rdata")
              )
  load(here("analysis", "data", "raw_data", "Attie_DO378_eQTL_viewer_v1.Rdata"))
  saveRDS(dataset.islet.rnaseq$lod.peaks, here("analysis", "data", "derived_data", "lod_peaks.rds"))
  saveRDS(dataset.islet.rnaseq$annots, here("analysis", "data", "derived_data", "annots.rds"))
  saveRDS(dataset.islet.rnaseq$expr, here("analysis", "data", "derived_data", "expr.rds"))
}
```

```{r}
lod_peaks <- readRDS(here("analysis", "data", "derived_data", "lod_peaks.rds"))
annots <- readRDS(here("analysis", "data", "derived_data", "annots.rds"))
expr <- readRDS(here("analysis", "data", "derived_data", "expr.rds"))
```



```{r setup_continued-2}
hot_chr <- 2
hot_mid <- 165.5
keller_mediator <- "Hnf4a"
```

```{r child="hotspot-one-chromosome.Rmd"}
```






## Chr 2 hotspot results

The scatter plot of pleiotropy test statistics and mediation LOD differences reveals that few local-nonlocal 
trait pairs have both a high value of the pleiotropy test statistic and a high value of the mediation LOD 
difference. Many points have low values of both, while some points demonstrate a high value of only mediation 
LOD difference or pleiotropy test statistic. 

Many points have negative values of mediation LOD difference. These correspond to pairs that, when conditioning 
on the putative mediator, the LOD for the nonlocal trait increased. 

The points are color-coded to identify those pairs that involve the local trait *Hnf4a*, which 
@keller2018genetic identified as a key mediator of traits at this hotspot. Blue points involve *Hnf4a*, while 
red points do not. We see that many blue point have large mediation LOD differences and small pleiotropy test 
statistics. In fact, most of the points with mediation LOD difference above 15 involve *Hnf4a* and have small 
pleiotropy test statistics.








```{r setup_continued-5}
hot_chr <- 5
hot_mid <- 146
keller_mediator <- "Pdx1"
```

```{r child="hotspot-one-chromosome.Rmd", eval = FALSE}
```





```{r setup_continued-7}
hot_chr <- 7
hot_mid <- 46
keller_mediator <- "Fam83e"
```

```{r child="hotspot-one-chromosome.Rmd", eval = FALSE}
```



```{r setup_continued-11}
hot_chr <- 11
hot_mid <- 71
keller_mediator <- "Sat2"
```

```{r child="hotspot-one-chromosome.Rmd", eval = FALSE}
```



```{r setup_continued-13}
hot_chr <- 13
hot_mid <- 112.5
keller_mediator <- "Il6st"
```

```{r child="hotspot-one-chromosome.Rmd", eval = FALSE}
```











# Discussion

Pleiotropy tests complement mediation analyses in the following manner. When considering a
collection of potential mediators for a nonlocal trait, mediation analyses clearly identify the
mediator when there is, in fact, a mediator among the candidates. However, when there is no
mediator, mediation analyses provide little information about the genetics of the complex trait.
Pleiotropy testing is particularly useful in this setting, since a pleiotropy test always gives
an answer about the number of underlying QTL. A drawback of pleiotropy testing is that the scientific question that it addresses - do two traits share a single QTL - informs, but doesn't fully resolve, the genetics of the nonlocal complex traits under study.









# Colophon

This report was generated on ` r Sys.time()` using the following computational environment and dependencies:

```{r colophon, cache = FALSE, echo = TRUE, tidy.opts=list(width.cutoff=50), size = "tiny", results = "markup"}
# which R packages and versions?
devtools::session_info()
```


The current Git commit details are:

```{r git2r, cache = FALSE, echo = TRUE}
# what commit is this file at?
git2r::repository(here::here())
```




